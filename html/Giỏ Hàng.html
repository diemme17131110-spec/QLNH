<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giỏ Hàng</title>
  <link rel="stylesheet" href="../css/giohang.css">
</head>
<body>

<div class="cart-container">
  <div class="cart-items">
    <h2>Giỏ hàng của bạn <span id="item-count">(0 sản phẩm)</span></h2>
    <table class="cart-table">
      <thead>
        <tr>
          <th>Sản phẩm</th>
          <th>Giá</th>
          <th>Số lượng</th>
          <th>Tổng cộng</th>
        </tr>
      </thead>
      <tbody id="cart-body">
        
      </tbody>
    </table>
  </div>

  <div class="order-summary">
    <h2>Tóm tắt đơn hàng</h2>
    <div class="summary-row">
      <span>Tạm tính</span>
      <span id="subtotal-price">0 ₫</span>
    </div>
    <div class="summary-row">
      <span>Phí vận chuyển</span>
      <span>Miễn phí</span>
    </div>
    <div class="summary-row summary-total">
      <span>TỔNG CỘNG</span>
      <span id="total-price">0 ₫</span>
    </div>
    <button onclick="window.location.href='thanhtoan.html'" class="checkout-btn">TIẾN HÀNH THANH TOÁN</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const cartBody = document.getElementById('cart-body');
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  const formatCurrency = (num) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(num);

  const updateCart = () => {
    cartBody.innerHTML = '';
    let subtotal = 0;

    cart.forEach((item, index) => {
      const itemTotal = item.price * item.quantity;
      subtotal += itemTotal;

      const row = document.createElement('tr');
      row.classList.add('cart-item');
      row.innerHTML = `
        <td>
          <div class="product-info">
            <img src="${item.img}" alt="">
            <h3>${item.name}</h3>
            <a class="remove-btn" data-index="${index}">Xóa</a>
          </div>
        </td>
        <td class="product-price">${formatCurrency(item.price)}</td>
        <td>
          <div class="quantity-control">
            <button class="btn-minus" data-index="${index}">-</button>
            <input type="number" class="item-quantity" value="${item.quantity}" min="1">
            <button class="btn-plus" data-index="${index}">+</button>
          </div>
        </td>
        <td class="product-total">${formatCurrency(itemTotal)}</td>
      `;
      cartBody.appendChild(row);
    });

    document.getElementById('item-count').textContent = `(${cart.length} sản phẩm)`;
    document.getElementById('subtotal-price').textContent = formatCurrency(subtotal);
    document.getElementById('total-price').textContent = formatCurrency(subtotal);
    localStorage.setItem('cart', JSON.stringify(cart));
  };

  // Nút +, -, xóa
  cartBody.addEventListener('click', (e) => {
    const index = e.target.dataset.index;
    if (e.target.classList.contains('btn-plus')) {
      cart[index].quantity++;
    } else if (e.target.classList.contains('btn-minus')) {
      if (cart[index].quantity > 1) cart[index].quantity--;
    } else if (e.target.classList.contains('remove-btn')) {
      cart.splice(index, 1);
    }
    updateCart();
  });

  // Sửa trực tiếp số lượng
  cartBody.addEventListener('change', (e) => {
    if (e.target.classList.contains('item-quantity')) {
      const index = e.target.closest('tr').querySelector('.btn-plus').dataset.index;
      let newQty = parseInt(e.target.value);
      if (newQty < 1 || isNaN(newQty)) newQty = 1;
      cart[index].quantity = newQty;
      updateCart();
    }
  });

  updateCart();
});
</script>
</body>
</html>
